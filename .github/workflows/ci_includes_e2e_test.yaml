name: CI + E2E

on:
  # ── Every Tuesday 19:33 UTC (= Wednesday 03:33 in Taipei, UTC+8) ──
  schedule:
    - cron: '33 19 * * 2'
  workflow_dispatch:        # Manually trigger（optional）
  push:
    branches:
      - "**e2e"
      - "e2e**"
    paths:
#     For GitHub Action
      - ".github/workflows/ci_includes_e2e_test.yaml"
      - ".github/workflows/rw_build_and_test.yaml"
      - ".github/workflows/rw_run_all_test_and_record.yaml"
#     For test code
      - "test/e2e_test/**/*.py"
#     For configurations for test or CI
      - ".coveragerc"
      - "codecov.yml"
      - "pytest.ini"
      - "sonar-project.properties"
#     For Python project configuration
      - "pyproject.toml"
      - "uv.lock"

jobs:
  build-and-test_all:
#    name: Run all tests and organize all test reports
    if: ${{ !contains(github.event.pull_request.labels.*.name, 'dependencies') }}
    uses: ./.github/workflows/rw_run_all_test_and_record.yaml
    with:
      run_e2e: true
      with-environment-variables: 'SLACK_TEST_CHANNEL_ID="${{ vars.SLACK_TEST_CHANNEL_ID }}"'
    secrets:
      e2e_test_api_token: ${{ secrets.SLACK_BOT_TOKEN }}
      codecov_token: ${{ secrets.CODECOV_TOKEN }}
      sonar_token: ${{ secrets.SONAR_TOKEN }}
